{
    include "testsuite.ycp";

    TESTSUITE_INIT ([$[ "target" : $[ "tmpdir": "/tmp" ] ], $[], $[]], nil);

    import "Service";

    map READ = $[];
    map EXEC = $[
	"target": $[
	    "bash": 0,
	    "bash_output": $["exit": 0, "stdout": "", "stderr" :""],
	    ],
	];

    // service does not exist
    READ = $[ "init" : $[ "scripts" : $[
                "runlevel" : $[
		    "aaa" : $[
                        "start" : [ "0", "1", "3" ],
                        "stop" : [ "4", "5", "6" ],
			]
                    ],
                "comment" : $[
		    "aaa" : $[
                        "defstart" : [ "0", "1", "3" ],
                        "defstop" : [ "4", "5", "6" ],
			]
                    ],
		"exists" : false,
	] ],
	    "target" : $[
		"stat" : $[]
	    ]
	];
    TEST (``(Service::Adjust ("aaa", "disable")), [ READ, $[], EXEC ], nil);

    // service exists and may run
    READ = $[ "init" : $[ "scripts" : $[
                "runlevel" : $[
		    "aaa" : $[
                        "start" : [ "0", "1", "3" ],
                        "stop" : [ "4", "5", "6" ],
			]
                    ],
                "comment" : $[
		    "aaa" : $[
                        "defstart" : [ "0", "1", "3" ],
                        "defstop" : [ "4", "5", "6" ],
			]
                    ],
		"exists" : true,
	] ],
	    "target" : $[
		"stat" : $["isreg": true]
	  ]
	];
    TEST (``(Service::Adjust ("aaa", "disable")), [ READ, $[], EXEC ], nil);

    // service exists and does not run
    READ = $[ "init" : $[ "scripts" : $[
                "runlevel" : $[
		    "aaa" : $[
                        "start" : [ ],
                        "stop" : [ ],
			]
                    ],
                "comment" : $[
		    "aaa" : $[
                        "defstart" : [ "0", "1", "3" ],
                        "defstop" : [ "4", "5", "6" ],
			]
                    ],
		"exists" : true,
	] ],
	    "target" : $[
		"stat" : $["isreg": true]
	  ]
	];
    TEST (``(Service::Adjust ("aaa", "disable")), [ READ, $[], EXEC ], nil);

    // service exists and does not run
    READ = $[ "init" : $[ "scripts" : $[
                "runlevel" : $[
		    "aaa" : $[
                        "start" : [ ],
                        "stop" : [ ],
			]
                    ],
                "comment" : $[
		    "aaa" : $[
                        "defstart" : [ "0", "1", "3" ],
                        "defstop" : [ "4", "5", "6" ],
			]
                    ],
		"exists" : true,
	] ],
	    "target" : $[
		"stat" : $["isreg": true]
	  ]
	];
    TEST (``(Service::Adjust ("aaa", "enable")), [ READ, $[], EXEC ], nil);

    READ = $[ "init" : $[ "scripts" : $[
                "runlevel" : $[
		    "aaa" : $[
                        "start" : [ "1" ],
                        "stop" : [ ],
			]
                    ],
                "comment" : $[
		    "aaa" : $[
                        "defstart" : [ "0", "1", "3" ],
                        "defstop" : [ "4", "5", "6" ],
			]
                    ],
		"exists" : true,
	] ],
	    "target" : $[
		"stat" : $["isreg": true]
	  ]
	];
    TEST (``(Service::Adjust ("aaa", "enable")), [ READ, $[], EXEC ], nil);

    READ = $[ "init" : $[ "scripts" : $[
                "runlevel" : $[
		    "aaa" : $[
                        "start" : [ "1" ],
                        "stop" : [ ],
			]
                    ],
                "comment" : $[
		    "aaa" : $[
                        "defstart" : [ "0", "1", "3" ],
                        "defstop" : [ "4", "5", "6" ],
			]
                    ],
		"exists" : true,
	] ],
	    "target" : $[
		"stat" : $["isreg": true]
	  ]
	];
    TEST (``(Service::Adjust ("aaa", "default")), [ READ, $[], EXEC ], nil);

    READ = $[ "init" : $[ "scripts" : $[
                "runlevel" : $[
		    "aaa" : $[
                        "start" : [ "0", "1", "3" ],
                        "stop" : [ ],
			]
                    ],
                "comment" : $[
		    "aaa" : $[
                        "defstart" : [ "0", "1", "3" ],
                        "defstop" : [ "4", "5", "6" ],
			]
                    ],
		"exists" : true,
	] ],
	    "target" : $[
		"stat" : $["isreg": true]
	  ]
	];
    TEST (``(Service::Adjust ("aaa", "default")), [ READ, $[], EXEC ], nil);

}
